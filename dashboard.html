<!DOCTYPE html><html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Dashboard - Ann Investment</title>
<style>
/* GENERAL */
body { margin: 0; font-family: Arial, sans-serif; background: #FFECCC; color: #5E1010; }
.dashboard-container { padding: 15px; max-width: 100%; box-sizing: border-box; }

/* TOP BAR */
.top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; }
.top-bar h2 { margin: 0; font-size: 20px; }
.top-bar button { background: #5E1010; color: #FFECCC; padding: 8px 14px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; }

/* HERO SECTION */
.hero-section { display: flex; gap: 15px; flex-wrap: wrap; }
.balance-card { background: #5E1010; color: #FFECCC; padding: 20px; border-radius: 12px; flex: 1 1 200px; min-width: 150px; box-sizing: border-box; }
.balance-card h3 { margin: 0; font-size: 16px; opacity: 0.8; }
.balance-card .amount { margin-top: 8px; font-size: 28px; font-weight: bold; }

/* MINI CARDS */
.mini-cards { display: flex; flex-wrap: wrap; gap: 10px; flex: 1 1 200px; }
.mini-card { flex: 1 1 60px; min-width: 100px; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.15); box-sizing: border-box; }
.mini-card h4 { margin: 0; font-size: 14px; opacity: 0.8; }
.mini-card .amount { margin-top: 6px; font-size: 18px; font-weight: bold; }

.hero-section {
display: flex;
gap: 15px;
flex-wrap: nowrap; /* keep the layout on one row /
overflow-x: auto;  / allow scrolling on small screens /
padding-bottom: 10px; / for spacing */
}

/* Balance card /
.balance-card {
flex: 0 0 250px; / fixed width */
min-width: 250px;
box-sizing: border-box;
}

/* Mini cards container /
.mini-cards {
display: flex;
flex-wrap: nowrap; / keep mini-cards in a row */
gap: 10px;
}

/* Each mini-card /
.mini-card {
flex: 0 0 120px; / fixed width */
min-width: 120px;
box-sizing: border-box;
}

/* ACTION BUTTONS */
.action-buttons { margin: 20px 0; display: flex; flex-wrap: wrap; gap: 10px; justify-content: flex-start; }
.action-buttons button { flex: 1 1 calc(33% - 10px); min-width: 90px; padding: 8px 10px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; color: #fff; font-size: 14px; }
.action-buttons .deposit { background: green; }
.action-buttons .invest { background: red; }
.action-buttons .withdraw { background: blue; }

/* TRANSACTION SECTION */
.trans-title { margin-top: 25px; font-size: 18px; font-weight: bold; }
.transaction-list { margin-top: 10px; background: #fff; padding: 10px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); overflow-x: auto; }
.transaction-item { padding: 10px 0; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; font-size: 14px; flex-wrap: wrap; }
.transaction-item:last-child { border-bottom: none; }
.date { opacity: 0.7; font-size: 12px; }

/* COLORS */
.deposit { color: green; }
.invest { color: red; }
.withdraw { color: blue; }

/* LOADER */
#loadingOverlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.4); backdrop-filter: blur(4px); z-index: 9999; justify-content: center; align-items: center; }
.spinner { width: 50px; height: 50px; border: 5px solid white; border-top-color: #5E1010; border-radius: 50%; animation: spin 0.9s linear infinite; }
@keyframes spin { 0%{transform:rotate(0);} 100%{transform:rotate(360deg);} }

/* RESPONSIVE ADJUSTMENTS */
@media (max-width: 700px) {
  .hero-section { flex-direction: column; }
  .mini-cards { flex-direction: row; justify-content: space-between; }
  .balance-card { margin-bottom: 10px; }
  .action-buttons { flex-direction: row; flex-wrap: wrap; }
  .action-buttons button { flex: 1 1 30%; min-width: 80px; font-size: 12px; }
}

@media (max-width: 450px) {
  .top-bar { flex-direction: column; gap: 10px; }
  .balance-card .amount { font-size: 24px; }
  .mini-card .amount { font-size: 16px; }
  .action-buttons button { flex: 1 1 100%; min-width: auto; font-size: 13px; }
}

</style>

</head>
<body>
<div class="dashboard-container">
  <!-- TOP BAR -->
  <div class="top-bar">
    <h2 id="welcomeUser">Welcome, User</h2>
    <button onclick="logout()">Logout</button>
  </div>  <!-- HERO SECTION -->  <div class="hero-section">
    <!-- CURRENT BALANCE -->
    <div class="balance-card">
      <h3>Current Balance</h3>
      <div class="amount" id="currentBalance">$0.00</div>
    </div><!-- MINI CARDS -->
<div class="mini-cards">
  <div class="mini-card">
    <h4>Total Deposit</h4>
    <div class="amount" id="totalDeposit">$0.00</div>
  </div>
  <div class="mini-card">
    <h4>Total Investment</h4>
    <div class="amount" id="totalInvestment">$0.00</div>
  </div>
  <div class="mini-card">
    <h4>Total Withdrawal</h4>
    <div class="amount" id="totalWithdrawal">$0.00</div>
  </div>
</div>



  </div>  <!-- ACTION BUTTONS -->  <div class="action-buttons">
    <button class="deposit" id="depositBtn">Deposit</button>
    <button class="invest" id="investBtn">Invest</button>
    <button class="withdraw" id="withdrawBtn">Withdraw</button>
    
  </div>  <!-- TRANSACTION HISTORY -->  <div class="trans-title">Transaction History</div>
  <div class="transaction-list" id="transactionList"></div>
</div><div id="loadingOverlay"><div class="spinner"></div></div>
();

<script>
const backend = "https://investment-9ub4.onrender.com/api";
const token = localStorage.getItem("token");
const adminWhatsApp = "09122054068";

// Redirect if no token
if(!token) window.location.href = "sign-in.html";

// Loader
function showLoader(){ document.getElementById("loadingOverlay").style.display="flex"; }
function hideLoader(){ document.getElementById("loadingOverlay").style.display="none"; }

// Logout
function logout(){ localStorage.removeItem("token"); window.location.href = "sign-in.html"; }

let minDeposit = 0;
let minWithdrawal = 0;

async function loadDashboard(){
  showLoader();
  try{
    const res = await fetch(`${backend}/me`, { headers: { "Authorization": `Bearer ${token}` } });
    const data = await res.json();
    hideLoader();

    if(res.status === 401){ alert("Session expired. Please login again."); logout(); return; }
    if(!res.ok) return alert(data.message || "Failed to load dashboard");

    const user = data.user;

    // Save minimums dynamically
    minDeposit = user.minDeposit || 0;
    minWithdrawal = user.minWithdrawal || 0;

    // Welcome
    document.getElementById("welcomeUser").textContent = `Welcome, ${user.firstName}`;

    // Stats
    document.getElementById("currentBalance").textContent = `$${(user.balance || 0).toLocaleString()}`;
    document.getElementById("totalDeposit").textContent = `$${(user.totalDeposit || 0).toLocaleString()}`;
    document.getElementById("totalInvestment").textContent = `$${(user.totalInvestment || 0).toLocaleString()}`;
    document.getElementById("totalWithdrawal").textContent = `$${(user.totalWithdrawal || 0).toLocaleString()}`;

    // Transactions
    const list = document.getElementById("transactionList");
    list.innerHTML = "";
    (user.transactions || []).forEach(t=>{
      const div = document.createElement("div");
      div.className = "transaction-item";
      const colorClass =
        t.type === "deposit" ? "deposit" :
        t.type === "investment" ? "invest" : "withdraw";
      div.innerHTML = `
        <span class="${colorClass}">${t.type.toUpperCase()} â€” $${t.amount.toLocaleString()}</span>
        <span class="date">${new Date(t.date || t.createdAt).toLocaleString()}</span>
      `;
      list.appendChild(div);
    });

    // Attach button handlers AFTER user data is loaded
    attachActionButtons();

  } catch(e){ hideLoader(); alert("Network error"); }
}

function attachActionButtons(){
  // Deposit button
  document.getElementById("depositBtn").onclick = () => {
    const amount = prompt(`Minimum deposit is $${minDeposit}. Enter deposit amount:`, minDeposit);
    if(amount && Number(amount) >= minDeposit){
      const message = `Hello Admin, I would like to make a deposit of $${amount}. Kindly assist.`;
      window.open(`https://wa.me/${adminWhatsApp}?text=${encodeURIComponent(message)}`, "_blank");
    } else if(amount) alert(`Deposit must be at least $${minDeposit}`);
  };

  // Invest button
  document.getElementById("investBtn").onclick = () => {
    const amount = prompt(`Enter the amount you want to invest:`);
    if(amount && Number(amount) > 0){
      const message = `Hello Admin, I would like to invest $${amount}. Kindly assist.`;
      window.open(`https://wa.me/${adminWhatsApp}?text=${encodeURIComponent(message)}`, "_blank");
    }
  };

  // Withdraw button
  document.getElementById("withdrawBtn").onclick = () => {
    const currentBalance = Number(document.getElementById("currentBalance").textContent.replace(/[^0-9.-]+/g,""));
    if(currentBalance < minWithdrawal){
      alert(`Your balance is below the minimum withdrawal amount of $${minWithdrawal}`);
      return;
    }
    const amount = prompt(`Enter withdrawal amount (minimum $${minWithdrawal}):`);
    if(amount && Number(amount) >= minWithdrawal){
      const message = `Hello Admin, I would like to withdraw $${amount}. Kindly assist.`;
      window.open(`https://wa.me/${adminWhatsApp}?text=${encodeURIComponent(message)}`, "_blank");
    } else if(amount) alert(`Withdrawal must be at least $${minWithdrawal}`);
  };
}

loadDashboard();
</script>
</body>
</html>