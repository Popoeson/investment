<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sign In - Ann Investment Company</title>

<style>
/* --- your styles stay the same --- */
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: linear-gradient(120deg, #5E1010 0%, #FFECCC 100%);
  color: #5E1010;
}
.container {
  max-width: 500px;
  margin: 60px auto;
  background: #fff;
  padding: 40px 30px;
  border-radius: 12px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}
.form-header { display:flex; justify-content:space-between; margin-bottom:30px; }
.form-header button { background:none; border:none; font-weight:bold; color:#5E1010; cursor:pointer; }
.form-header button.active { border-bottom:3px solid #5E1010; padding-bottom:4px; }
form { display:flex; flex-direction:column; }
form input, form select, form label { margin-bottom:15px; }
form input[type="text"], form input[type="email"], form input[type="password"], form input[type="tel"], form input[type="date"] {
  padding:12px; border-radius:6px; border:1px solid #ccc; width:100%;
}
form label { font-weight:bold; margin-bottom:5px; }
form button.submit-btn, .form-step button.next-btn, .form-step button.back-btn {
  background:#5E1010; color:#FFECCC; padding:12px; border:none; border-radius:6px; cursor:pointer;
}
#loginForm { display:none; opacity:0; transition:0.5s; animation:dropIn 0.5s forwards; }
#loginForm.active { display:flex; opacity:1; }
.form-step { display:none; flex-direction:column; animation:dropIn 0.5s forwards; }
.form-step.active { display:flex; }
@keyframes dropIn { from{opacity:0; transform:translateY(-20px);} to{opacity:1; transform:translateY(0);} }

#popup{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);display:none;justify-content:center;align-items:center;}
.popup-content{background:#fff;width:90%;max-width:400px;padding:25px;border-radius:12px;text-align:center;color:#5E1010;}

#loadingOverlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);backdrop-filter:blur(5px);justify-content:center;align-items:center;}
.spinner{width:60px;height:60px;border:6px solid white;border-top-color:#5E1010;border-radius:50%;animation:spin .9s linear infinite;}
@keyframes spin{to{transform:rotate(360deg);}}
</style>
</head>

<body>

<div id="loadingOverlay"><div class="spinner"></div></div>

<div class="container">

  <div class="form-header">
    <button id="registerBtn" class="active">Register</button>
    <button id="loginBtn">Login</button>
  </div>

  <!-- REGISTER -->
  <form id="registerForm">

    <!-- STEP 1 -->
    <div class="form-step active" id="step1">
      <label>First Name</label><input type="text" id="firstName" required>
      <label>Last Name</label><input type="text" id="lastName" required>
      <label>Email</label><input type="email" id="email" required>
      <label>Phone</label><input type="tel" id="phone" required>
      <label>Date of Birth</label><input type="date" id="dob" required>

      <button type="button" class="next-btn" onclick="nextStep(1)">Continue</button>
    </div>

    <!-- STEP 2 -->
    <div class="form-step" id="step2">
      <label>Street</label><input type="text" id="street" required>
      <label>City</label><input type="text" id="city" required>
      <label>State</label><input type="text" id="state" required>
      <label>ZIP</label><input type="text" id="zip" required>

      <label>Password</label><input type="password" id="password" required>
      <label>Confirm Password</label><input type="password" id="confirmPassword" required>

      <div style="display:flex; justify-content:space-between;">
        <button type="button" class="submit-btn" onclick="submitRegistration()">Register</button>
        <button type="button" class="back-btn" onclick="prevStep(2)">Back</button>
      </div>
    </div>

  </form>

  <!-- LOGIN -->
  <form id="loginForm">
    <label>Email</label><input type="email" id="loginEmail" required>
    <label>Password</label><input type="password" id="loginPassword" required>
    <button type="button" class="submit-btn" id="loginBtnSubmit">Login</button>
  </form>

</div>

<!-- SUCCESS POPUP -->
<div id="popup">
  <div class="popup-content">
    <h3>Registration Successful!</h3>
    <p>Your account has been created.</p>
    <button onclick="closePopup()">Close</button>
  </div>
</div>

<script>
const backend = "https://investment-9ub4.onrender.com/api";

function nextStep(c){ document.getElementById(`step${c}`).classList.remove("active"); document.getElementById(`step${c+1}`).classList.add("active"); }
function prevStep(c){ document.getElementById(`step${c}`).classList.remove("active"); document.getElementById(`step${c-1}`).classList.add("active"); }

function showLoader(){ document.getElementById("loadingOverlay").style.display="flex"; }
function hideLoader(){ document.getElementById("loadingOverlay").style.display="none"; }

async function submitRegistration(){
  if(password.value !== confirmPassword.value){
    alert("Passwords do not match");
    return;
  }

  showLoader();

  const data = {
    firstName:firstName.value,
    lastName:lastName.value,
    email:email.value,
    phone:phone.value,
    dob:dob.value,
    street:street.value,
    city:city.value,
    state:state.value,
    zip:zip.value,
    password:password.value
  };

  try{
    const res = await fetch(`${backend}/register`,{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify(data)
    });

    const result = await res.json();
    hideLoader();

    if(res.ok){
      popup.style.display="flex";
      document.getElementById("registerForm").reset();
    } else {
      alert(result.message || "Registration failed");
    }

  } catch(e){
    hideLoader();
    alert("Network error");
  }
}

// LOGIN
loginBtnSubmit.onclick = async () => {
  showLoader();
  const res = await fetch(`${backend}/login`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ email:loginEmail.value, password:loginPassword.value })
  });

  const data = await res.json();
  hideLoader();

  if(res.ok){
    localStorage.setItem("token", data.token);
    if(data.user) localStorage.setItem("userData", JSON.stringify(data.user));
    window.location.href = data.user.role === "admin" ? "admin-dashboard.html" : "dashboard.html";
  } else {
    alert(data.message || "Invalid login");
  }
};

function closePopup(){ popup.style.display="none"; }
</script>

</body>
</html>